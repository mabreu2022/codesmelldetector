program CodeSmellDetector;

{$APPTYPE CONSOLE}

uses
  System.SysUtils,
  System.IOUtils,
  uAnalyzer in 'uAnalyzer.pas',
  uRelatorioJSON in 'uRelatorioJSON.pas',
  uRelatorioCSV in 'uRelatorioCSV.pas',
  uRelatorioHTML in 'uRelatorioHTML.pas';

var
  Dir, ExecutavelPath, PastaRelatorios: string;

begin
  try
    if ParamCount < 1 then
    begin
      Writeln('Uso: CodeSmellDetector <diretório>');
      Exit;
    end;

    Dir := ParamStr(1);

    if not TDirectory.Exists(Dir) then
    begin
      Writeln('Erro: diretório não encontrado: ', Dir);
      Exit;
    end;

    // Diretório do executável
    ExecutavelPath := TPath.GetDirectoryName(ParamStr(0));
    PastaRelatorios := TPath.Combine(ExecutavelPath, 'relatorios');

    // Cria a pasta se não existir
    if not TDirectory.Exists(PastaRelatorios) then
      TDirectory.CreateDirectory(PastaRelatorios);

    Writeln('?? Iniciando análise no diretório: ', Dir);
    AnalisarDiretorio(Dir, PastaRelatorios);
    Writeln('? Análise concluída com sucesso.');
    Writeln('?? Relatórios gerados em: ', PastaRelatorios);
  except
    on E: Exception do
      Writeln('? Erro durante a execução: ', E.Message);
  end;
end.
